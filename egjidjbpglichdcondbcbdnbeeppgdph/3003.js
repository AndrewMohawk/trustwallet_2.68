"use strict";(self.webpackChunkbrowser_extension_wallet=self.webpackChunkbrowser_extension_wallet||[]).push([[3003],{83003:((Tt,j,t)=>{t.r(j),t.d(j,{default:()=>it});var x=t(74848),J=t(2496),V=t(29584),X=t(63369),Z=t(23688),N=t(68157),k=t(52856),$=t(97665),b=t(6475),o=t(96540),g=t(22670),L=t(62266),F=t(64145),q=t(33055);const _=()=>{const{tx:r,wallet:a}=N.M_.getState();return(0,o.useMemo)(()=>{var e,n,l;return(l=(n=(e=r.fetchedAllChainsTransactionPeriodsByAccount)==null?void 0:e[a.walletId])==null?void 0:n[a.selectedAccountId])!=null?l:{}},[r.fetchedAllChainsTransactionPeriodsByAccount,a.walletId,a.selectedAccountId])};var A=t(85005),tt=t(10537),et=t(9389),D=(r,a,e)=>new Promise((n,l)=>{var T=s=>{try{f(e.next(s))}catch(S){l(S)}},d=s=>{try{f(e.throw(s))}catch(S){l(S)}},f=s=>s.done?n(s.value):Promise.resolve(s.value).then(T,d);f((e=e.apply(r,a)).next())});const C=29;function nt(){const r=(0,q.v)(),a=(0,et.Cb)(),{from:e,to:n,blockchains:l,nextToken:T}=_(),d=(0,tt.n)(!0),f=(0,$.jE)(),[s,S]=(0,o.useState)(new Date),[u,R]=(0,o.useState)((0,A.t6)(new Date,C)),[Y,G]=(0,o.useState)(!1),[Q,W]=(0,o.useState)(!1),[m,ct]=(0,o.useState)(T),[K,lt]=(0,o.useState)([]),[O,rt]=(0,o.useState)(!0),w=(0,o.useRef)(0),M=(0,o.useMemo)(()=>d.filter(i=>!K.includes(i.id)),[d,K]),ut=(0,o.useCallback)(()=>{!e||!n||!O||new Date(e)<new Date(u)&&D(null,null,function*(){yield F.YW.emit(g.A.FETCH_ALL_CHAINS_MISSING_TRANSACTIONS,{from:s,to:e,blockchains:M}),S(new Date(n)),R((0,A.t6)(new Date(n),C)),G(!0)})},[e,n,s,u]),ht=(0,o.useCallback)(i=>{if(!O)return;D(null,null,function*(){yield F.YW.emit(g.A.FETCH_ALL_CHAINS_MISSING_TRANSACTIONS,{from:new Date(e),to:new Date(n),blockchains:i})})},[]),P=(i,c,h)=>{ct(h),N.M_.dispatch(k.B.actions.updateAllChainsCachedTransactionsPeriod({blockchains:M.map(B=>B.id),selectedWalletId:r,accountId:a,from:i,to:c,nextToken:h}))},dt=i=>D(null,[i],function*({pageParam:c}){w.current++;const{transactions:h,nextToken:B,unsupportedChains:I}=yield F.YW.emit(g.A.FETCH_ASSETS_TRANSACTION_HISTORY,{from:c.from,to:c.to,nextToken:c.nextToken,blockchains:M});let H=c.from,p=c.to,y=B;if(h?.length&&N.M_.dispatch(k.B.actions.updateTxs({items:h,walletId:r,accountId:a})),I?.length&&(lt(I),l?.length)){const z=d.filter(E=>!I.includes(E.id)).filter(E=>!l.includes(E.id));z.length>0&&ht(z)}return e||P(s.toISOString(),u.toISOString()),c.from>new Date(e)&&u<new Date(e)&&(P(s.toISOString(),n,m),H=(0,A.t6)(new Date(n),-C),p=new Date(n),y=void 0),(c.to<new Date(n)||new Date(n).getTime()===c.to.getTime()&&y!==m)&&P(e,u.toISOString(),y),Y&&G(!1),S(H),R(p),W(!h?.length),ut(),{transactions:h,from:H,to:p,nextToken:y}}),{fetchNextPage:U,hasNextPage:ft,isFetchingNextPage:vt}=(0,b.q)({queryKey:["transactions",r],queryFn:dt,refetchOnWindowFocus:!1,refetchOnReconnect:!1,staleTime:1e3*60*5,gcTime:1e3*60*60*24,enabled:O,initialPageParam:{from:s,to:u,nextToken:void 0},getNextPageParam:i=>{var c;if(!(u<=L.Qp||i===null))return Y?{from:s,to:u,nextToken:m}:i.nextToken||m?{nextToken:(c=i.nextToken)!=null?c:m,from:s,to:u}:{from:new Date(i.to.getTime()),to:(0,A.t6)(i.to,C)}}});return(0,o.useEffect)(()=>{Q&&w.current>1&&u>L.Qp&&U(),W(!1)},[Q]),(0,o.useEffect)(()=>()=>{f.removeQueries(),rt(!1)},[]),{fetchNextPage:U,hasNextPage:ft,isFetchingNextPage:vt,isFirstFetch:w.current<2}}var st=t(69325),v=t(4800),ot=t(67310),at=t(6442);const it=(0,Z.K)(()=>{(0,X.K)({event:V.Un.HISTORY,props:null});const{formatMessage:r}=(0,at.A)(),a=(0,st.q)(),e=window.innerHeight-v.a4-v.e4-v.Et-64,[n,l]=(0,o.useState)(!0),{fetchNextPage:T,hasNextPage:d,isFetchingNextPage:f,isFirstFetch:s}=nt();return(0,o.useEffect)(()=>{(Object.keys(a).length||!s)&&l(!1)},[a]),(0,x.jsxs)(v.LN,{children:[(0,x.jsx)(v.zY,{title:r({id:"history-list.title"})}),(0,x.jsx)(v.Gv,{children:(0,x.jsx)(ot.A,{dataLength:Object.values(a).flat().length,next:T,height:e,className:"tw-scrollbar",hasMore:!!d,loader:null,style:{display:"flex",flexDirection:"column"},children:(0,x.jsx)(J.D,{transactions:a,scrollableAreaHeight:e,loadMoreItems:T,fetchingTransactions:f||n,hasNextPage:d,historyAvailable:!0})})})]})})})}]);
